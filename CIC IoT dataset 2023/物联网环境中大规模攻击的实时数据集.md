
æœ¬ç ”ç©¶çš„ä¸»è¦ç›®æ ‡æ˜¯æå‡ºä¸€ä¸ªæ–°é¢–ä¸”å¹¿æ³›çš„ç‰©è”ç½‘æ”»å‡»æ•°æ®é›†ï¼Œä»¥ä¿ƒè¿›å®é™…ç‰©è”ç½‘è¿è¥ä¸­å®‰å…¨åˆ†æåº”ç”¨ç¨‹åºçš„å¼€å‘ã€‚ä¸ºæ­¤ï¼Œåœ¨ç”± 105 ä¸ªè®¾å¤‡ç»„æˆçš„ç‰©è”ç½‘æ‹“æ‰‘ä¸­æ‰§è¡Œäº† 33 æ¬¡æ”»å‡»ã€‚

è¿™äº›æ”»å‡»åˆ†ä¸ºä¸ƒç±»ï¼Œåˆ†åˆ«æ˜¯ DDoSã€DoSã€Reconã€åŸºäº Webã€æš´åŠ›ç ´è§£ã€æ¬ºéª—å’Œ Miraiã€‚æœ€åï¼Œæ‰€æœ‰æ”»å‡»éƒ½æ˜¯ç”±æ¶æ„ IoT è®¾å¤‡é’ˆå¯¹å…¶ä»– IoT è®¾å¤‡æ‰§è¡Œçš„ã€‚

## æ•°æ®é›†ç›®å½•
***


ä¸»æ•°æ®é›†ç›®å½•ï¼ˆCICIoT2023ï¼‰åŒ…å«å››ä¸ªä¸ä¸åŒæ–‡ä»¶ç›¸å…³çš„å­ç›®å½•ï¼Œåˆ†åˆ«æ˜¯ï¼š

1. **PCAPï¼šåŒ…å«æ”»å‡»æœŸé—´æ•è·çš„åŸå§‹æµé‡ï¼ˆ`.pcp` æ–‡ä»¶ï¼‰ï¼›

2. **CSVï¼šåŒ…å«ä»åŸå§‹æ–‡ä»¶ä¸­æå–çš„ç‰¹å¾ï¼Œç”¨äºæœºå™¨å­¦ä¹ ï¼ˆ`ML`ï¼‰è¯„ä¼°ï¼ˆ`.csv` æ–‡ä»¶ï¼‰ï¼›

3. **exampleï¼šä¸€ä¸ª `jupyter` ç¬”è®°æœ¬ï¼Œå±•ç¤ºå¦‚ä½•ä½¿ç”¨æ•°æ®é›†æ¥è®­ç»ƒå’Œè¯„ä¼°æ”»å‡»æ£€æµ‹å’Œåˆ†ç±»ä¸­çš„æœºå™¨å­¦ä¹  (ML) æ¨¡å‹ï¼›

4. **è¡¥å……ææ–™ï¼šåœ¨æ”¶é›†å’Œæ•´ç†æ”»å‡»æ•°æ®çš„è¿‡ç¨‹ä¸­ä½¿ç”¨çš„å·¥å…·çš„æºä»£ç å’Œè¯´æ˜ã€‚æˆ‘ä»¬ä½¿ç”¨ Mergecap åˆå¹¶å¤šä¸ª `.pcap` æ–‡ä»¶ï¼Œä½¿ç”¨ `PySpark` å¤„ç†æ•°æ®ï¼Œä½¿ç”¨ `TCPDump` å°† `.pcap` æ–‡ä»¶æ‹†åˆ†ä¸ºå¤šä¸ªè¾ƒå°çš„æ–‡ä»¶ï¼Œå¹¶ä½¿ç”¨ `DPKT` æå–ç‰¹å¾ã€‚

## Example
***

### å¯¼å…¥åº“åŠæ–‡ä»¶

```Python
import pandas as pd
import numpy as np
import os
from tqdm import tqdm
import warnings
warnings.filterwarnings('ignore')  #å¿½ç•¥æ‰€æœ‰è­¦å‘Šä¿¡æ¯
from sklearn.linear_model import LogisticRegression
from sklearn.impute import SimpleImputer
```

- `pandas`: ç”¨äºæ•°æ®å¤„ç†ï¼Œç‰¹åˆ«æ˜¯æ•°æ®è¡¨æ ¼ï¼ˆDataFrameï¼‰æ“ä½œã€‚
- `numpy`: æä¾›é«˜æ•ˆçš„æ•°ç»„è¿ç®—ï¼Œå¸¸ç”¨äºæ•°å€¼è®¡ç®—å’ŒçŸ©é˜µæ“ä½œã€‚
- `os`: å¤„ç†æ–‡ä»¶è·¯å¾„ã€ç›®å½•æ“ä½œç­‰ï¼Œä¸æ“ä½œç³»ç»Ÿäº¤äº’ã€‚
- `tqdm`: ç”¨äºæ˜¾ç¤ºè¿›åº¦æ¡ï¼Œé€‚ç”¨äºéå†å¤§å‹æ•°æ®é›†æ—¶æå‡å¯è§†åŒ–ä½“éªŒã€‚
- `warnings`: è¯¥æ¨¡å—ç”¨äºç®¡ç†Pythonçš„è­¦å‘Šä¿¡æ¯ã€‚
- `LogisticRegression`: ä» `sklearn.linear_model` å¯¼å…¥é€»è¾‘å›å½’æ¨¡å‹ï¼Œç”¨äºåˆ†ç±»ä»»åŠ¡ï¼ˆå¦‚äºŒåˆ†ç±»æˆ–å¤šåˆ†ç±»é—®é¢˜ï¼‰ã€‚
- `SimpleImputer`: ä» `sklearn.impute` å¯¼å…¥ `SimpleImputer`ï¼Œç”¨äºå¤„ç†ç¼ºå¤±å€¼ï¼ˆä¾‹å¦‚ç”¨å‡å€¼ã€ä¸­ä½æ•°æˆ–ä¼—æ•°å¡«å……ç¼ºå¤±å€¼ï¼‰ã€‚
  
>[!note] é€»è¾‘å›å½’æ¨¡å‹
>é€»è¾‘å›å½’ï¼ˆLogistic Regressionï¼‰æ˜¯ä¸€ç§ç”¨äº**åˆ†ç±»ä»»åŠ¡**çš„æœºå™¨å­¦ä¹ ç®—æ³•ï¼Œé€šå¸¸ç”¨äº**äºŒåˆ†ç±»é—®é¢˜**ï¼Œä½†ä¹Ÿå¯ä»¥æ‰©å±•åˆ°å¤šåˆ†ç±»é—®é¢˜ã€‚ï¼ˆä¸æ”¯æŒGPUåŠ é€Ÿï¼‰
>**æ ¸å¿ƒæ€æƒ³ï¼š
>- ä½¿ç”¨ **çº¿æ€§å›å½’** çš„æ€æƒ³è®¡ç®—è¾“å…¥å˜é‡çš„åŠ æƒå’Œï¼ˆ`w*x + b`ï¼‰ã€‚
>- ç„¶åä½¿ç”¨ **Sigmoid** å‡½æ•°ï¼ˆSå½¢å‡½æ•°ï¼‰å°†è¾“å‡ºæ˜ å°„åˆ° `[0,1]` ä¹‹é—´ï¼Œè¡¨ç¤ºæŸä¸ªç±»åˆ«çš„æ¦‚ç‡ã€‚
>Sigmoid å‡½æ•°å…¬å¼ï¼š
>$$
Ïƒ(z)= \frac{1}{1+e^{-z}}$$

```Python
DATASET_DIRECTORY = '../CICIoT2023/'  #..ä»£è¡¨ä¸Šä¸€çº§ç›®å½•ã€‚
```

å®šä¹‰äº†ä¸€ä¸ªå˜é‡ `DATASET_DIRECTORY`ï¼Œå®ƒå­˜å‚¨äº†æ•°æ®é›†çš„ç›®å½•è·¯å¾„ `'../CICIoT2023/'`ã€‚
è·¯å¾„æŒ‡å‘çš„æ˜¯**å½“å‰ä»£ç æ‰€åœ¨ç›®å½•çš„ä¸Šä¸€çº§ç›®å½•ä¸­çš„ `CICIoT2023` æ–‡ä»¶å¤¹**ã€‚

### åˆ’åˆ†æ•°æ®é›†

```Python
df_sets = [k for k in os.listdir(DATASET_DIRECTORY) if k.endswith('.csv')]
df_sets.sort()  #æŒ‰ç…§æ–‡ä»¶åè¿›è¡Œæ’åº
training_sets = df_sets[:int(len(df_sets)*.8)]  #ä»ç´¢å¼•0åˆ°int(len(df_sets)*.8çš„éƒ¨åˆ†
test_sets = df_sets[int(len(df_sets)*.8):] Â #ä»int(len(df_sets)*.8åˆ°æœ€å
```

ä»æŒ‡å®šç›®å½•ä¸­è·å– .csv æ–‡ä»¶ï¼Œå¹¶æŒ‰ 80% è®­ç»ƒé›†ã€20% æµ‹è¯•é›†çš„æ¯”ä¾‹è¿›è¡Œåˆ’åˆ†ã€‚

- `os.listdir(DATASET_DIRECTORY)`:  
    è·å– `DATASET_DIRECTORY` ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶å’Œæ–‡ä»¶å¤¹çš„åˆ—è¡¨ã€‚
- `if k.endswith('.csv')`:  
    è¿‡æ»¤å‡ºæ‰€æœ‰ä»¥ `.csv` ç»“å°¾çš„æ–‡ä»¶ï¼Œå³æ•°æ®é›†æ–‡ä»¶ã€‚
- `df_sets` æ˜¯ä¸€ä¸ª `.csv` æ–‡ä»¶åçš„åˆ—è¡¨ã€‚

- `len(df_sets) * 0.8` è®¡ç®—å‡º 80% çš„ç´¢å¼•ä½ç½®ï¼Œå¹¶è½¬æ¢ä¸ºæ•´æ•°ï¼ˆ`int()`ï¼‰ã€‚
- `training_sets` å–å‰ 80% ä½œä¸ºè®­ç»ƒé›†ã€‚
- `test_sets` å–å‰©ä¸‹çš„ 20% ä½œä¸ºæµ‹è¯•é›†ã€‚
  
### å®šä¹‰ç‰¹å¾åˆ—

```Python
X_columns = [
    'Header_Length', 'Protocol Type', 'Rate', 'fin_flag_number', 'syn_flag_number', 'rst_flag_number', 
    'psh_flag_number', 'ack_flag_number', 'ece_flag_number', 'cwr_flag_number', 'ack_count', 'syn_count', 
    'fin_count', 'rst_count', 'HTTP', 'HTTPS', 'DNS', 'Telnet', 'SMTP', 'SSH', 'IRC', 'TCP', 'UDP', 
    'DHCP', 'ARP', 'ICMP', 'IPv', 'LLC', 'Tot sum', 'Min', 'Max', 'AVG', 'Std', 'Tot size', 'IAT', 
    'Number', 'Variance'
]
y_column = 'Label'
```

**`X_columns`**ï¼šç‰¹å¾åˆ—

**`y_column`**ï¼šç›®æ ‡åˆ—
`Label` ä¸€èˆ¬æ˜¯ä¸€ä¸ª**äºŒåˆ†ç±»ï¼ˆ0 æˆ– 1ï¼‰**ï¼Œç”¨äºåŒºåˆ†æ­£å¸¸æµé‡ï¼ˆ0ï¼‰å’Œæ”»å‡»æµé‡ï¼ˆ1ï¼‰ã€‚

>[!note] ç½‘ç»œæµé‡ç‰¹å¾
> **ğŸ”¹åŸºæœ¬ç½‘ç»œç‰¹å¾**
>- **`Header_Length`**ï¼šæ•°æ®åŒ…çš„å¤´éƒ¨é•¿åº¦ã€‚
>- **`Protocol Type`**ï¼šåè®®ç±»å‹ï¼ˆTCPã€UDPã€ICMPç­‰ï¼‰ã€‚
>- **`Rate`**ï¼šæŸæ®µæ—¶é—´å†…çš„æµé‡é€Ÿç‡ã€‚
>
 >**ğŸ”¹ TCP/IP æ ‡å¿—ä½**
>- **`fin_flag_number`ã€`syn_flag_number`ã€`rst_flag_number`ã€`psh_flag_number`ã€`ack_flag_number`**ï¼šTCP æ ‡å¿—ä½ï¼ˆå¦‚ SYNã€ACKã€FINã€RSTç­‰ï¼‰ï¼Œç”¨äºæ£€æµ‹æ”»å‡»æ¨¡å¼ï¼ˆå¦‚SYN Floodã€RSTæ”»å‡»ç­‰ï¼‰ã€‚
>- **`ack_count`ã€`syn_count`ã€`fin_count`ã€`rst_count`**ï¼šè®°å½• ACKã€SYNã€FINã€RST åŒ…çš„æ•°é‡ã€‚
>
>**ğŸ”¹ åº”ç”¨å±‚åè®®**
>- **`HTTP`ã€`HTTPS`ã€`DNS`ã€`Telnet`ã€`SMTP`ã€`SSH`ã€`IRC`**ï¼šæ˜¯å¦å±äºè¿™äº›åè®®ã€‚
>- **`TCP`ã€`UDP`ã€`DHCP`ã€`ARP`ã€`ICMP`ã€`IPv`ã€`LLC`**ï¼šæ˜¯å¦ä½¿ç”¨è¿™äº›åè®®ã€‚
>
>**ğŸ”¹ ç»Ÿè®¡ç‰¹å¾**
>- **`Tot sum`**ï¼šæ€»æ•°æ®é‡ã€‚
>- **`Min`ã€`Max`ã€`AVG`ã€`Std`**ï¼šç»Ÿè®¡å­¦ç‰¹å¾ï¼Œå¦‚æœ€å°å€¼ã€æœ€å¤§å€¼ã€å‡å€¼ã€æ ‡å‡†å·®ã€‚
>- **`Variance`**ï¼šæ–¹å·®ï¼Œè¡¡é‡æ•°æ®çš„æ³¢åŠ¨æ€§ã€‚
>- **`IAT`**ï¼ˆInter-Arrival Timeï¼‰ï¼šæ•°æ®åŒ…ä¹‹é—´çš„åˆ°è¾¾æ—¶é—´é—´éš”ã€‚

### åˆ›å»ºæ ‡å‡†åŒ–å¯¹è±¡

```Python
from sklearn.preprocessing import MinMaxScaler, StandardScaler
scaler = StandardScaler()
```

- **`MinMaxScaler`** å’Œ **`StandardScaler`** éƒ½æ˜¯ `sklearn.preprocessing` ä¸­çš„**æ•°æ®å½’ä¸€åŒ–/æ ‡å‡†åŒ–å·¥å…·**ã€‚
- `scaler = StandardScaler()` åˆ›å»ºäº†ä¸€ä¸ª**æ ‡å‡†åŒ–å¯¹è±¡**ï¼Œç”¨äºå¯¹æ•°æ®è¿›è¡Œæ ‡å‡†åŒ–è½¬æ¢ã€‚
  
#### `StandardScaler`

**`StandardScaler`** é‡‡ç”¨**Z-Score æ ‡å‡†åŒ–**ï¼Œå°†æ•°æ®è½¬æ¢ä¸º**å‡å€¼ä¸º 0ï¼Œæ ‡å‡†å·®ä¸º 1** çš„åˆ†å¸ƒï¼š
$$
Xâ€²= \frac{X - \mu}{\sigma}
$$

- $Î¼$ æ˜¯ç‰¹å¾çš„å‡å€¼ã€‚
- $Ïƒ$ æ˜¯ç‰¹å¾çš„æ ‡å‡†å·®ã€‚
  
**ä½œç”¨ï¼š**
- æ¶ˆé™¤é‡çº²å½±å“ï¼Œè®©ä¸åŒç‰¹å¾çš„æ•°å€¼åœ¨ç›¸åŒå°ºåº¦ä¸Šã€‚
- åŠ å¿«æ¢¯åº¦ä¸‹é™ï¼Œæœ‰åŠ©äºæé«˜æœºå™¨å­¦ä¹ æ¨¡å‹çš„æ”¶æ•›é€Ÿåº¦ã€‚
- é€‚ç”¨äºæ­£æ€åˆ†å¸ƒæ•°æ®ï¼ˆè‹¥æ•°æ®æœä»é«˜æ–¯åˆ†å¸ƒï¼Œæ ‡å‡†åŒ–æ•ˆæœæ›´å¥½ï¼‰ã€‚

**ç”¨æ³•ï¼š**
```Python
from sklearn.preprocessing import StandardScaler
import numpy as np

# åˆ›å»ºæ•°æ®
X = np.array([[10, 1000], [20, 2000], [30, 3000]])

# åˆå§‹åŒ– StandardScaler
scaler = StandardScaler()

# è¿›è¡Œæ ‡å‡†åŒ–
X_scaled = scaler.fit_transform(X)

print(X_scaled)

```

```Out
[[-1.22474487 -1.22474487]
 [ 0.          0.        ]
 [ 1.22474487  1.22474487]]
```

- `-1.22474487` è¡¨ç¤ºè¿™ä¸ªå€¼æ¯”å‡å€¼å° 1.22 ä¸ªæ ‡å‡†å·®ã€‚
- `1.22474487` è¡¨ç¤ºè¿™ä¸ªå€¼æ¯”å‡å€¼å¤§ 1.22 ä¸ªæ ‡å‡†å·®ã€‚
  
#### `MinMaxScaler`

è®¡ç®—æ–¹å¼æ˜¯ï¼š
$$
X^â€²= \frac{X - X_{\min}}{X_{\max} - X_{\min}}â€‹â€‹
$$
- ç»“æœä¼šè¢«ç¼©æ”¾åˆ° **[0,1] æˆ– [-1,1]** ä¹‹é—´ã€‚
- é€‚ç”¨äº**éæ­£æ€åˆ†å¸ƒ**æ•°æ®ï¼Œæ¯”å¦‚å›¾åƒåƒç´ ï¼ˆ0-255ï¼‰ã€‚

### å®šä¹‰æ¨¡å‹

```Python
ML_models = [
Â  Â  Â  Â  LogisticRegression(n_jobs=-1),
]

ML_names = [
Â  Â  Â  Â  "LogisticRegression",
]
```
- **`ML_models`**ï¼šå­˜å‚¨äº†ä¸€ä¸ªæœºå™¨å­¦ä¹ æ¨¡å‹ï¼ˆ**é€»è¾‘å›å½’**ï¼‰ã€‚
- **`ML_names`**ï¼šå­˜å‚¨äº†æ¨¡å‹åç§°ï¼Œæ–¹ä¾¿åç»­æ‰“å°ç»“æœæˆ–åšå¯è§†åŒ–åˆ†æã€‚
- `n_jobs=-1`ï¼šè¡¨ç¤º**ä½¿ç”¨æ‰€æœ‰ CPU æ ¸å¿ƒè¿›è¡Œå¹¶è¡Œè®¡ç®—**ï¼ŒåŠ é€Ÿè®­ç»ƒï¼ˆå¦‚æœæ•°æ®é›†è¾ƒå¤§ï¼Œè®­ç»ƒé€Ÿåº¦ä¼šæ›´å¿«ï¼‰ã€‚
  
### è®­ç»ƒé›†æ•°æ®é¢„å¤„ç†
  
```Python
for train_set in tqdm(training_sets):
Â  Â  # è¯»å–æ•°æ®
Â  Â  d = pd.read_csv(DATASET_DIRECTORY + train_set)
Â  Â  # é€‰æ‹©ç‰¹å¾åˆ—
Â  Â  X = d[X_columns]
Â  Â  Y = d[y_column]
Â  Â  # å¤„ç†æ— ç©·å¤§
Â  Â  X.replace([np.inf, -np.inf], np.nan, inplace=True)
Â  Â  # å¤„ç† NaNï¼ˆç”¨å‡å€¼å¡«å……ï¼‰
Â  Â  imputer = SimpleImputer(strategy='mean')
Â  Â  X = imputer.fit_transform(X)
	# å¤„ç†æ ‡ç­¾åˆ—ä¸­çš„ç¼ºå¤±å€¼
Â  Â  Y.fillna("Unknown", inplace=True)
```

ä½¿ç”¨ `pandas` çš„ `read_csv()` å‡½æ•°è¯»å– `train_set` å¯¹åº”çš„ CSV æ–‡ä»¶ã€‚
- `DATASET_DIRECTORY + train_set` æ˜¯æ–‡ä»¶è·¯å¾„ï¼Œ`train_set` æ˜¯æ¯ä¸ªè®­ç»ƒé›†çš„æ–‡ä»¶åã€‚
- è¯»å–çš„å†…å®¹ä¼šè¢«å­˜å‚¨åœ¨ `d` è¿™ä¸ª `DataFrame` ä¸­ã€‚
  
é€šè¿‡ `replace()` å°† `X` ä¸­çš„æ— ç©·å¤§ (`np.inf`) å’Œè´Ÿæ— ç©·å¤§ (`-np.inf`) å€¼æ›¿æ¢ä¸º `NaN`ã€‚

`SimpleImputer(strategy='mean')`ï¼šå¤„ç†ç¼ºå¤±å€¼ã€‚`strategy='mean'` è¡¨ç¤ºå°†ç¼ºå¤±å€¼å¡«å……ä¸ºæ¯åˆ—çš„ **å‡å€¼**ã€‚

`fit_transform(X)`ï¼š
	`fit()`ï¼šè®¡ç®—æ¯åˆ—çš„å‡å€¼ã€‚
	`transform()`ï¼šå°†æ¯åˆ—çš„ç¼ºå¤±å€¼ `NaN` ç”¨å‡å€¼å¡«å……ï¼Œè¿”å›ä¸€ä¸ªæ–°çš„ NumPy æ•°ç»„ï¼ˆæ³¨æ„ï¼Œè¿™é‡Œ `X` è¢«è½¬æ¢æˆäº† NumPy æ•°ç»„ï¼‰ã€‚

`fillna("Unknown", inplace=True)` ç”¨ `"Unknown"` å­—ç¬¦ä¸²å¡«å…… `Y` ä¸­çš„æ‰€æœ‰ç¼ºå¤±å€¼ `NaN`ã€‚

### æ ‡å‡†åŒ–æ•°æ®

```Python
scaler.fit(X)
X = scaler.transform(X)
```

- [[#`StandardScaler`|scaler]] æ˜¯ `StandardScaler`æ ‡å‡†åŒ–å¯¹è±¡ï¼Œå®ƒç”¨æ¥**è®¡ç®—ç‰¹å¾çš„å‡å€¼å’Œæ ‡å‡†å·®**ã€‚
- `fit(X)` è®¡ç®—å¹¶å­˜å‚¨ `X` ä¸­æ¯ä¸€åˆ—çš„å‡å€¼ï¼ˆmeanï¼‰å’Œæ ‡å‡†å·®ï¼ˆstandard deviationï¼‰ã€‚
    - å¯¹äºæ¯ä¸€åˆ—ç‰¹å¾ `X_i`ï¼Œ`StandardScaler` ä¼šè®¡ç®—ï¼š 
      $$\mu_i = \text{mean}(X_i) \quad \text{å’Œ} \quad \sigma_i = \text{std}(X_i)$$
    - è¿™äº›è®¡ç®—ç»“æœä¼šè¢« `scaler` ä¿å­˜ä¸‹æ¥ï¼Œä»¥ä¾¿åœ¨ `transform(X)` ä¸­ä½¿ç”¨ã€‚
      
 
 
- `transform(X)` æ˜¯å°† `X` ä¸­çš„æ¯ä¸€åˆ—ç‰¹å¾è¿›è¡Œ**æ ‡å‡†åŒ–**ï¼š $$X'_i = \frac{X_i - \mu_i}{\sigma_i}$$
    - $X'_i$ æ˜¯æ ‡å‡†åŒ–åçš„ç‰¹å¾å€¼ã€‚
    - å¯¹æ¯ä¸ªç‰¹å¾ $X_i$ï¼Œä¼šå‡å»è¯¥ç‰¹å¾çš„å‡å€¼ $\mu_i$ï¼Œç„¶åé™¤ä»¥æ ‡å‡†å·® $\sigma_i$ï¼Œå°†å…¶è½¬æ¢ä¸ºå‡å€¼ä¸º 0ã€æ ‡å‡†å·®ä¸º 1 çš„åˆ†å¸ƒã€‚
- è¿™æ ·ï¼Œæ ‡å‡†åŒ–åçš„ `X` ä¸­æ¯ä¸€åˆ—çš„å‡å€¼å°†æ¥è¿‘ 0ï¼Œæ ‡å‡†å·®æ¥è¿‘ 1ã€‚
  
### è®­ç»ƒæ¨¡å‹

```Python
for model in (ML_models): 
	model.fit(X, Y) 
del d
```


[[#å®šä¹‰æ¨¡å‹|ML_models]]åªå®šä¹‰äº†ä¸€ä¸ªæ¨¡å‹å³LogisticRegressionã€‚
**`model.fit(X, Y)`**ï¼š
- `fit()` æ–¹æ³•ç”¨äºè®­ç»ƒæ¨¡å‹ã€‚
- `X` æ˜¯è®­ç»ƒæ•°æ®ä¸­çš„ç‰¹å¾çŸ©é˜µï¼Œ`Y` æ˜¯å¯¹åº”çš„æ ‡ç­¾å‘é‡ã€‚
- è¯¥æ“ä½œå°†åŸºäº `X` å’Œ `Y` è¿›è¡Œè®­ç»ƒï¼Œå­¦ä¹ å‡ºæ¨¡å‹çš„å‚æ•°ã€‚

**`del d`** ç”¨äºåˆ é™¤å˜é‡ `d`ï¼Œä»¥èŠ‚çœå†…å­˜ç©ºé—´ã€‚

### æ¨¡å‹é¢„æµ‹

```Python
y_test = []
preds = {i:[] for i in range(len(ML_models))}
for test_set in tqdm(test_sets): # éå†æ¯ä¸ªæµ‹è¯•é›†
Â  Â  d_test = pd.read_csv(DATASET_DIRECTORY + test_set)
Â  Â  X_test = d_test[X_columns]
Â  Â  # å¤„ç†æ— ç©·å¤§
Â  Â  X_test.replace([np.inf, -np.inf], np.nan, inplace=True)
Â  Â  # å¤„ç† NaNï¼ˆç”¨å‡å€¼å¡«å……ï¼‰
Â  Â  imputer = SimpleImputer(strategy='mean')
Â  Â  X_test = imputer.fit_transform(X_test)
Â  Â  X_test = scaler.transform(X_test)  # æ ‡å‡†åŒ–å¤„ç†

Â  Â  y_test += list(d_test[y_column].values)

Â  Â  for i in range(len(ML_models)):
Â  Â  Â  Â  model = ML_models[i]
Â  Â  Â  Â  y_pred = list(model.predict(X_test))
Â  Â  Â  Â  preds[i] = preds[i] + y_pred
```

- **`y_test = []`**ï¼šè¿™æ˜¯ä¸€ä¸ªç©ºåˆ—è¡¨ï¼Œç”¨äºå­˜å‚¨æ‰€æœ‰æµ‹è¯•é›†çš„çœŸå®æ ‡ç­¾ã€‚
- **`preds = {i:[] for i in range(len(ML_models))}`**ï¼šåˆ›å»ºä¸€ä¸ªå­—å…¸ `preds`ï¼Œå®ƒçš„é”®æ˜¯æ¨¡å‹çš„ç´¢å¼•ï¼Œå€¼æ˜¯ä¸€ä¸ªç©ºåˆ—è¡¨ï¼Œç”¨äºå­˜å‚¨æ¯ä¸ªæ¨¡å‹çš„é¢„æµ‹ç»“æœã€‚
  
  é€šè¿‡ `for` å¾ªç¯éå†æ¯ä¸ªæ¨¡å‹ï¼Œè°ƒç”¨ `model.predict(X_test)` å¯¹æµ‹è¯•é›†è¿›è¡Œé¢„æµ‹ã€‚
- `model.predict(X_test)` è¿”å›çš„æ˜¯æ¨¡å‹å¯¹ `X_test` çš„é¢„æµ‹ç»“æœã€‚
- é¢„æµ‹ç»“æœ `y_pred` è¢«è½¬æ¢ä¸ºåˆ—è¡¨ï¼Œå¹¶åŠ å…¥åˆ° `preds` å­—å…¸ä¸­ï¼Œ`preds[i]` æ˜¯æ¨¡å‹ `i` çš„é¢„æµ‹ç»“æœã€‚
  
### è¾“å‡ºç»“æœ

```Python
from sklearn.metrics import accuracy_score, recall_score, precision_score, f1_score
for k,v in preds.items():
Â  Â  y_pred = v
Â  Â  print(f"##### {ML_names[k]} (34 classes) #####")
Â  Â  print('accuracy_score = ', accuracy_score(y_pred, y_test))
Â  Â  print('recall_score = ', recall_score(y_pred, y_test, average='macro'))
Â  Â  print('precision_score = ', precision_score(y_pred, y_test, average='macro'))
Â  Â  print('f1_score = ', f1_score(y_pred, y_test, average='macro'))
Â  Â  print()
Â  Â  print()
Â  Â  print()
```

- `accuracy_score`ï¼šè®¡ç®—åˆ†ç±»æ¨¡å‹çš„**å‡†ç¡®ç‡**ï¼Œå³æ­£ç¡®é¢„æµ‹çš„æ ·æœ¬å æ€»æ ·æœ¬çš„æ¯”ä¾‹ã€‚
- `recall_score`ï¼šè®¡ç®—åˆ†ç±»æ¨¡å‹çš„**å¬å›ç‡**ï¼Œå³æ­£ç¡®é¢„æµ‹çš„æ­£ç±»å æ‰€æœ‰æ­£ç±»çš„æ¯”ä¾‹ã€‚
- `precision_score`ï¼šè®¡ç®—åˆ†ç±»æ¨¡å‹çš„**ç²¾ç¡®ç‡**ï¼Œå³æ­£ç¡®é¢„æµ‹çš„æ­£ç±»å æ‰€æœ‰é¢„æµ‹ä¸ºæ­£ç±»çš„æ¯”ä¾‹ã€‚
- `f1_score`ï¼šè®¡ç®—**F1åˆ†æ•°**ï¼Œæ˜¯ç²¾ç¡®ç‡å’Œå¬å›ç‡çš„è°ƒå’Œå¹³å‡æ•°ï¼Œè¡¡é‡åˆ†ç±»æ¨¡å‹çš„ç»¼åˆæ€§èƒ½ã€‚
  
  - **`for k, v in preds.items():`**ï¼š
    - `preds` æ˜¯ä¸€ä¸ªå­—å…¸ï¼Œå…¶ä¸­æ¯ä¸ªé”® `k` å¯¹åº”ä¸€ä¸ªæ¨¡å‹ï¼ˆä¾‹å¦‚ï¼š`LogisticRegression`ï¼‰ï¼Œæ¯ä¸ªå€¼ `v` æ˜¯è¯¥æ¨¡å‹çš„é¢„æµ‹ç»“æœåˆ—è¡¨ã€‚
    - `k` æ˜¯æ¨¡å‹çš„ç´¢å¼•ï¼Œ`v` æ˜¯è¯¥æ¨¡å‹çš„é¢„æµ‹ç»“æœã€‚
- **`y_pred = v`**ï¼š
    - `y_pred` æ˜¯å½“å‰æ¨¡å‹ `k` çš„é¢„æµ‹ç»“æœã€‚

```Out
##### LogisticRegression (34 classes) ##### 
accuracy_score: 0.7518522629130883 
recall_score: 0.5493143330727824 
precision_score: 0.465848001355893 
f1_score: 0.466456453946256



```

>[!note] `average='macro'`
>`average='macro'` è¡¨ç¤ºå¯¹æ¯ä¸ªç±»åˆ«å•ç‹¬è®¡ç®—è¯„ä¼°æŒ‡æ ‡ï¼ˆå¦‚å¬å›ç‡ã€ç²¾ç¡®ç‡ã€F1åˆ†æ•°ï¼‰ï¼Œç„¶åå¯¹æ‰€æœ‰ç±»åˆ«çš„è¯„ä¼°ç»“æœè¿›è¡Œ**ä¸åŠ æƒå¹³å‡**ã€‚
>**å®è§‚å¹³å‡**ï¼ˆMacro-averageï¼‰æ„å‘³ç€æ¯ä¸ªç±»çš„è´¡çŒ®æ˜¯ç›¸ç­‰çš„ï¼Œä¸ç®¡å„ç±»æ ·æœ¬çš„æ•°é‡æœ‰å¤šå°‘

### æ”»å‡»æ˜ å°„

#### 7ç±»

```Python
dict_7classes = {}
dict_7classes['DDOS-RSTFINFLOOD'] = 'DDOS'
dict_7classes['DDOS-PSHACK_FLOOD'] = 'DDOS'
dict_7classes['DDOS-SYN_FLOOD'] = 'DDOS'
dict_7classes['DDOS-UDP_FLOOD'] = 'DDOS'
dict_7classes['DDOS-TCP_FLOOD'] = 'DDOS'
dict_7classes['DDOS-ICMP_FLOOD'] = 'DDOS'
dict_7classes['DDOS-SYNONYMOUSIP_FLOOD'] = 'DDOS'
dict_7classes['DDOS-ACK_FRAGMENTATION'] = 'DDOS'
dict_7classes['DDOS-UDP_FRAGMENTATION'] = 'DDOS'
dict_7classes['DDOS-ICMP_FRAGMENTATION'] = 'DDOS'
dict_7classes['DDOS-SLOWLORIS'] = 'DDOS'
dict_7classes['DDOS-HTTP_FLOOD'] = 'DDOS'

dict_7classes['DOS-UDP_FLOOD'] = 'DOS'
dict_7classes['DOS-SYN_FLOOD'] = 'DOS'
dict_7classes['DOS-TCP_FLOOD'] = 'DOS'
dict_7classes['DOS-HTTP_FLOOD'] = 'DOS'

dict_7classes['MIRAI-GREETH_FLOOD'] = 'MIRAI'
dict_7classes['MIRAI-GREIP_FLOOD'] = 'MIRAI'
dict_7classes['MIRAI-UDPPLAIN'] = 'MIRAI'

dict_7classes['RECON-PINGSWEEP'] = 'RECON'
dict_7classes['RECON-OSSCAN'] = 'RECON'
dict_7classes['RECON-PORTSCAN'] = 'RECON'
dict_7classes['VULNERABILITYSCAN'] = 'RECON'
dict_7classes['RECON-HOSTDISCOVERY'] = 'RECON'

dict_7classes['DNS_SPOOFING'] = 'SPOOFING'
dict_7classes['MITM-ARPSPOOFING'] = 'SPOOFING'

dict_7classes['BENIGN'] = 'BENIGN'
dict_7classes['UNKNOWN'] = 'BENIGN'

dict_7classes['BROWSERHIJACKING'] = 'WEB'
dict_7classes['BACKDOOR_MALWARE'] = 'WEB'
dict_7classes['XSS'] = 'WEB'
dict_7classes['UPLOADING_ATTACK'] = 'WEB'
dict_7classes['SQLINJECTION'] = 'WEB'
dict_7classes['COMMANDINJECTION'] = 'WEB'

dict_7classes['DICTIONARYBRUTEFORCE'] = 'BRUTEFORCE'
```

å­—å…¸ `dict_7classes`ï¼Œç”¨äºå°†ä¸åŒçš„æ”»å‡»ç±»å‹æ˜ å°„åˆ°ä¸ƒä¸ªç±»åˆ«ä¸­çš„ä¸€ä¸ªã€‚

>[!note] ç½‘ç»œæ”»å‡»
>- **DDOS (åˆ†å¸ƒå¼æ‹’ç»æœåŠ¡æ”»å‡»)**ï¼š
>	- ä¾‹å¦‚ï¼š`DDOS-RSTFINFLOOD`ã€`DDOS-PSHACK_FLOOD` ç­‰ã€‚
>- **DOS (æ‹’ç»æœåŠ¡æ”»å‡»)**ï¼š
>	- ä¾‹å¦‚ï¼š`DOS-UDP_FLOOD`ã€`DOS-SYN_FLOOD` ç­‰ã€‚
>- **MIRAI (Mirai æ¶æ„è½¯ä»¶æ”»å‡»)**ï¼š
>	- ä¾‹å¦‚ï¼š`MIRAI-GREETH_FLOOD`ã€`MIRAI-GREIP_FLOOD` ç­‰ã€‚
>- **RECON (ä¾¦å¯Ÿæ”»å‡»)**ï¼š
> 	- ä¾‹å¦‚ï¼š`RECON-PINGSWEEP`ã€`RECON-OSSCAN` ç­‰ã€‚
>- **SPOOFING (æ¬ºéª—æ”»å‡»)**ï¼š
> 	- ä¾‹å¦‚ï¼š`DNS_SPOOFING`ã€`MITM-ARPSPOOFING`ã€‚
>- **BENIGN (æ­£å¸¸æµé‡)**ï¼š
> 	- ä¾‹å¦‚ï¼š`BENIGN` å’Œ `UNKNOWN`ã€‚
>- **WEB (Webæ”»å‡»)**ï¼š
 >	- ä¾‹å¦‚ï¼š`BROWSERHIJACKING`ã€`BACKDOOR_MALWARE` ç­‰ã€‚
>- **BRUTEFORCE (æš´åŠ›ç ´è§£æ”»å‡»)**ï¼š
> 	- ä¾‹å¦‚ï¼š`DICTIONARYBRUTEFORCE`ã€‚
   
#### 2ç±»

```Python
dict_2classes = {}
dict_2classes['DDOS-RSTFINFLOOD'] = 'ATTACK'
dict_2classes['DDOS-PSHACK_FLOOD'] = 'ATTACK'
dict_2classes['DDOS-SYN_FLOOD'] = 'ATTACK'
dict_2classes['DDOS-UDP_FLOOD'] = 'ATTACK'
dict_2classes['DDOS-TCP_FLOOD'] = 'ATTACK'
dict_2classes['DDOS-ICMP_FLOOD'] = 'ATTACK'

dict_2classes['DDOS-SYNONYMOUSIP_FLOOD'] = 'ATTACK'
dict_2classes['DDOS-ACK_FRAGMENTATION'] = 'ATTACK'
dict_2classes['DDOS-UDP_FRAGMENTATION'] = 'ATTACK'
dict_2classes['DDOS-ICMP_FRAGMENTATION'] = 'ATTACK'
dict_2classes['DDOS-SLOWLORIS'] = 'ATTACK'
dict_2classes['DDOS-HTTP_FLOOD'] = 'ATTACK'

dict_2classes['DOS-UDP_FLOOD'] = 'ATTACK'
dict_2classes['DOS-SYN_FLOOD'] = 'ATTACK'
dict_2classes['DOS-TCP_FLOOD'] = 'ATTACK'
dict_2classes['DOS-HTTP_FLOOD'] = 'ATTACK'

dict_2classes['MIRAI-GREETH_FLOOD'] = 'ATTACK'
dict_2classes['MIRAI-GREIP_FLOOD'] = 'ATTACK'
dict_2classes['MIRAI-UDPPLAIN'] = 'ATTACK'

dict_2classes['RECON-PINGSWEEP'] = 'ATTACK'
dict_2classes['RECON-OSSCAN'] = 'ATTACK'
dict_2classes['RECON-PORTSCAN'] = 'ATTACK'
dict_2classes['VULNERABILITYSCAN'] = 'ATTACK'
dict_2classes['RECON-HOSTDISCOVERY'] = 'ATTACK'

dict_2classes['DNS_SPOOFING'] = 'ATTACK'
dict_2classes['MITM-ARPSPOOFING'] = 'ATTACK'

dict_2classes['BENIGN'] = 'BENIGN'
dict_2classes['UNKNOWN'] = 'BENIGN'

dict_2classes['BROWSERHIJACKING'] = 'ATTACK'
dict_2classes['BACKDOOR_MALWARE'] = 'ATTACK'
dict_2classes['XSS'] = 'ATTACK'
dict_2classes['UPLOADING_ATTACK'] = 'ATTACK'
dict_2classes['SQLINJECTION'] = 'ATTACK'
dict_2classes['COMMANDINJECTION'] = 'ATTACK'

dict_2classes['DICTIONARYBRUTEFORCE'] = 'ATTACK'
```

å­—å…¸ `dict_2classes`ï¼Œå°†ä¸åŒçš„æ”»å‡»ç±»å‹æ˜ å°„åˆ°ï¼š`ATTACK` æˆ– `BENIGN`ï¼ˆæ­£å¸¸æµé‡ï¼‰ã€‚

### å­—å…¸æ˜ å°„

```Python
d[y_column] = [dict_7classes[k] for k in d[y_column]]
```

```Python
d[y_column] = [dict_2classes[k] for k in d[y_column]]
```

**`[dict_7classes[k] for k in d[y_column]]`**ï¼š

- è¿™æ˜¯ä¸€ä¸ªåˆ—è¡¨æ¨å¯¼å¼ï¼Œç”¨æ¥éå† `d[y_column]` ä¸­çš„æ¯ä¸ªå…ƒç´ ï¼ˆä¹Ÿå°±æ˜¯æ¯ä¸ªæ ‡ç­¾ï¼‰ï¼Œé€šè¿‡ `dict_7classes[k]` ä»å­—å…¸ä¸­æŸ¥æ‰¾å¹¶è·å–å¯¹åº”çš„ç®€åŒ–æ ‡ç­¾ã€‚
- `k` æ˜¯ `d[y_column]` ä¸­çš„æ¯ä¸ªåŸå§‹æ ‡ç­¾ï¼ˆæ¯”å¦‚ `DDOS-RSTFINFLOOD`ï¼‰ã€‚
- `dict_7classes[k]` æ ¹æ® `k` æŸ¥æ‰¾ `dict_7classes` å­—å…¸ä¸­çš„å€¼ï¼Œå¾—åˆ°ç®€åŒ–åçš„ç±»åˆ«æ ‡ç­¾ï¼ˆå¦‚ `DDOS`ï¼‰ã€‚
  
### æ˜ å°„ç»“æœ

#### 7ç±»

```Out
##### LogisticRegression_7 (8 classes) ##### 
accuracy_score = 0.8296364015363655 
recall_score = 0.6887042816911841 
precision_score = 0.5302193234524215 
f1_score = 0.5513885230861422



```

#### 2ç±»

```Out
##### LogisticRegression (2 classes) ##### 
accuracy_score: 0.9871493187973056 
recall_score: 0.8612072363868772 
precision_score: 0.854005573046825 
f1_score: 0.8575679913187281



```